{% load static %}
{% load i18n %}

<div id="mail-test-container" class="relative bg-white rounded-lg shadow-sm">
    <form hx-post="{% url 'horilla_mail:send_test_email_view' %}?instance_id={{instance_id}}" id="mail-test-form" hx-swap="outerHTML" hx-target="#mail-test-container" enctype="multipart/form-data"
        hx-indicator="#hard-delete-spinner">
        {% csrf_token %}
        <div class="p-5">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-md font-semibold">{% trans "Test Email Configuration" %}</h2>
                <button type="button" onclick="closeModal()" class="text-gray-500 hover:text-red-500 text-xl cursor-pointer">
                    <img src="{% static 'assets/icons/close.svg' %}" alt="Close" />
                </button>
            </div>
            {% if form.non_field_errors %}
                <div class="bg-red-50 text-red-500 px-4 py-3 rounded-lg text-sm mb-4">
                    {% for error in form.non_field_errors %}
                        {{ error }}<br>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="overflow-hidden overflow-y-auto pe-2">
                <div class="grid grid-cols-1 gap-4 mb-3">
                    <div class="flex flex-col">
                        <div class="flex justify-between items-center mb-1">
                            <label for="{{ form.to_email.id_for_label }}" class="text-xs text-color-600">
                                {{ form.to_email.label }}
                                {% if form.to_email.field.required %}
                                    <span class="text-red-500">*</span>
                                {% endif %}
                            </label>
                        </div>

                        <input
                            type="email"
                            name="{{ form.to_email.name }}"
                            id="{{ form.to_email.id_for_label }}"
                            class="text-color-600 p-2 placeholder:text-xs font-normal w-full border border-dark-50 rounded-md mt-1 focus-visible:outline-0 placeholder:text-dark-100 text-sm transition duration-300 focus:border-primary-600"
                            placeholder="{% trans 'Enter email address to send test email' %}"
                            {% if form.to_email.field.required %}required{% endif %}
                            {% if form.to_email.value %}value="{{ form.to_email.value }}"{% endif %}
                        />

                        {% if form.to_email.help_text %}
                            <div class="text-xs text-gray-500 mt-1">{{ form.to_email.help_text }}</div>
                        {% endif %}

                        {% if form.to_email.errors %}
                            <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                                {% for error in form.to_email.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-end p-5 pt-0">
            <button type="submit" class="text-sm px-4 py-2 bg-primary-600 rounded-md hover:bg-primary-800 transition duration-300 text-[white]">
                <span class="flex items-center gap-2">
                    <span id="hard-delete-spinner" class="htmx-indicator">
                        <img src="{% static 'assets/icons/spinner.svg' %}" alt="Loading..." width="25">
                    </span>
                    {% trans "Send Test Email" %}
                </span>
            </button>
        </div>
    </form>
</div>
